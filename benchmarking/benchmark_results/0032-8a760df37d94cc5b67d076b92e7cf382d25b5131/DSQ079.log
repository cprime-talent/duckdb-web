<<Query Profiling Information>>
WITH all_sales AS ( SELECT d_year , i_brand_id , i_class_id , i_category_id , i_manufact_id , SUM(sales_cnt) AS sales_cnt , SUM(sales_amt) AS sales_amt FROM (SELECT d_year , i_brand_id , i_class_id , i_category_id , i_manufact_id , cs_quantity - COALESCE(cr_return_quantity,0) AS sales_cnt , cs_ext_sales_price - COALESCE(cr_return_amount,0.0) AS sales_amt FROM catalog_sales JOIN item ON i_item_sk=cs_item_sk JOIN date_dim ON d_date_sk=cs_sold_date_sk LEFT JOIN catalog_returns ON (cs_order_number=cr_order_number AND cs_item_sk=cr_item_sk) WHERE i_category='Books' UNION SELECT d_year , i_brand_id , i_class_id , i_category_id , i_manufact_id , ss_quantity - COALESCE(sr_return_quantity,0) AS sales_cnt , ss_ext_sales_price - COALESCE(sr_return_amt,0.0) AS sales_amt FROM store_sales JOIN item ON i_item_sk=ss_item_sk JOIN date_dim ON d_date_sk=ss_sold_date_sk LEFT JOIN store_returns ON (ss_ticket_number=sr_ticket_number AND ss_item_sk=sr_item_sk) WHERE i_category='Books' UNION SELECT d_year , i_brand_id , i_class_id , i_category_id , i_manufact_id , ws_quantity - COALESCE(wr_return_quantity,0) AS sales_cnt , ws_ext_sales_price - COALESCE(wr_return_amt,0.0) AS sales_amt FROM web_sales JOIN item ON i_item_sk=ws_item_sk JOIN date_dim ON d_date_sk=ws_sold_date_sk LEFT JOIN web_returns ON (ws_order_number=wr_order_number AND ws_item_sk=wr_item_sk) WHERE i_category='Books') sales_detail GROUP BY d_year, i_brand_id, i_class_id, i_category_id, i_manufact_id) SELECT prev_yr.d_year AS prev_year , curr_yr.d_year AS year_ , curr_yr.i_brand_id , curr_yr.i_class_id , curr_yr.i_category_id , curr_yr.i_manufact_id , prev_yr.sales_cnt AS prev_yr_cnt , curr_yr.sales_cnt AS curr_yr_cnt , curr_yr.sales_cnt-prev_yr.sales_cnt AS sales_cnt_diff , curr_yr.sales_amt-prev_yr.sales_amt AS sales_amt_diff FROM all_sales curr_yr, all_sales prev_yr WHERE curr_yr.i_brand_id=prev_yr.i_brand_id AND curr_yr.i_class_id=prev_yr.i_class_id AND curr_yr.i_category_id=prev_yr.i_category_id AND curr_yr.i_manufact_id=prev_yr.i_manufact_id AND curr_yr.d_year=2002 AND prev_yr.d_year=2002-1 AND CAST(curr_yr.sales_cnt AS DECIMAL(17,2))/CAST(prev_yr.sales_cnt AS DECIMAL(17,2))<0.9 ORDER BY sales_cnt_diff, sales_amt_diff LIMIT 100;
<<Timing>>
Total Time: 30.340922s
<<Operator Tree>>
--------------------
|       LIMIT      |
|      (0.00s)     |
|         0        |
--------------------
--------------------
|     ORDER_BY     |
|      (0.00s)     |
|         0        |
--------------------
--------------------
|    PROJECTION    |
|      (0.00s)     |
|         0        |
--------------------
--------------------
|      FILTER      |
|   CAST[DECIMAL]  |
|    (sales_cnt)   |
|  / CAST[DECIMAL] |
|   (sales_cnt))   |
|     < 0.900000   |
|      (0.00s)     |
|         0        |
--------------------
--------------------
|     HASH_JOIN    |
|       INNER      |
|   i_manufact_id  |
|  =i_manufact_id  |
|   i_category_id  |
|  =i_category_id  |
|    i_class_id    |
|    =i_class_id   |
|    i_brand_id    |
|    =i_brand_id   |
|      (0.00s)     |
|         0        |
--------------------
--------------------                                                                                                                                                                                                                            --------------------
|      FILTER      |                                                                                                                                                                                                                            |      FILTER      |
|   d_year = 2002  |                                                                                                                                                                                                                            |   d_year = 2001  |
|      (0.00s)     |                                                                                                                                                                                                                            |      (0.00s)     |
|         0        |                                                                                                                                                                                                                            |         0        |
--------------------                                                                                                                                                                                                                            --------------------
--------------------                                                                                                                                                                                                                            --------------------
|   HASH_GROUP_BY  |                                                                                                                                                                                                                            |   HASH_GROUP_BY  |
|      (0.00s)     |                                                                                                                                                                                                                            |      (5.79s)     |
|         0        |                                                                                                                                                                                                                            |         0        |
--------------------                                                                                                                                                                                                                            --------------------
--------------------                                                                                                                                                                                                                            --------------------
|       UNION      |                                                                                                                                                                                                                            |       UNION      |
|      (0.00s)     |                                                                                                                                                                                                                            |      (0.02s)     |
|         0        |                                                                                                                                                                                                                            |     81632498     |
--------------------                                                                                                                                                                                                                            --------------------
--------------------                                                                                                                                            --------------------                                                            --------------------                                                                                                                                            --------------------
|    PROJECTION    |                                                                                                                                            |    PROJECTION    |                                                            |    PROJECTION    |                                                                                                                                            |    PROJECTION    |
|      (0.00s)     |                                                                                                                                            |      (0.00s)     |                                                            |      (0.10s)     |                                                                                                                                            |      (0.00s)     |
|         0        |                                                                                                                                            |         0        |                                                            |     81632498     |                                                                                                                                            |         0        |
--------------------                                                                                                                                            --------------------                                                            --------------------                                                                                                                                            --------------------
--------------------                                                                                                                                            --------------------                                                            --------------------                                                                                                                                            --------------------
|       UNION      |                                                                                                                                            |    PROJECTION    |                                                            |       UNION      |                                                                                                                                            |    PROJECTION    |
|      (0.00s)     |                                                                                                                                            |      (0.00s)     |                                                            |      (0.02s)     |                                                                                                                                            |      (0.00s)     |
|         0        |                                                                                                                                            |         0        |                                                            |     81632498     |                                                                                                                                            |         0        |
--------------------                                                                                                                                            --------------------                                                            --------------------                                                                                                                                            --------------------
--------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------
|    PROJECTION    |                                                            |    PROJECTION    |                                                            |      FILTER      |                                                            |    PROJECTION    |                                                            |    PROJECTION    |                                                            |      FILTER      |
|                  |                                                            |                  |                                                            |    i_category    |                                                            |                  |                                                            |                  |                                                            |    i_category    |
|                  |                                                            |                  |                                                            |      = Books     |                                                            |                  |                                                            |                  |                                                            |      = Books     |
|      (0.00s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |                                                            |      (0.13s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |
|         0        |                                                            |         0        |                                                            |         0        |                                                            |     81632498     |                                                            |         0        |                                                            |         0        |
--------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------
--------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------
|    PROJECTION    |                                                            |    PROJECTION    |                                                            |     HASH_JOIN    |                                                            |    PROJECTION    |                                                            |    PROJECTION    |                                                            |     HASH_JOIN    |
|                  |                                                            |                  |                                                            |       LEFT       |                                                            |                  |                                                            |                  |                                                            |       LEFT       |
|                  |                                                            |                  |                                                            |    ws_item_sk    |                                                            |                  |                                                            |                  |                                                            |    ws_item_sk    |
|                  |                                                            |                  |                                                            |    =wr_item_sk   |                                                            |                  |                                                            |                  |                                                            |    =wr_item_sk   |
|                  |                                                            |                  |                                                            |  ws_order_number |                                                            |                  |                                                            |                  |                                                            |  ws_order_number |
|                  |                                                            |                  |                                                            | =wr_order_number |                                                            |                  |                                                            |                  |                                                            | =wr_order_number |
|      (0.00s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |                                                            |      (1.49s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |
|         0        |                                                            |         0        |                                                            |         0        |                                                            |     81632498     |                                                            |         0        |                                                            |         0        |
--------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------                                                            --------------------
--------------------                                                            --------------------                                                            --------------------                                        ----------------------------------------                                                            --------------------                                                            --------------------                                        --------------------
|      FILTER      |                                                            |      FILTER      |                                                            |   CROSS_PRODUCT  |                                        |     SEQ_SCAN     ||      FILTER      |                                                            |      FILTER      |                                                            |   CROSS_PRODUCT  |                                        |     SEQ_SCAN     |
|    i_category    |                                                            |    i_category    |                                                            |                  |                                        |    web_returns   ||    i_category    |                                                            |    i_category    |                                                            |                  |                                        |    web_returns   |
|      = Books     |                                                            |      = Books     |                                                            |                  |                                        |                  ||      = Books     |                                                            |      = Books     |                                                            |                  |                                        |                  |
|      (0.00s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |                                        |      (0.00s)     ||      (4.32s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |                                        |      (0.00s)     |
|         0        |                                                            |         0        |                                                            |         0        |                                        |         0        ||     81632498     |                                                            |         0        |                                                            |         0        |                                        |         0        |
--------------------                                                            --------------------                                                            --------------------                                        ----------------------------------------                                                            --------------------                                                            --------------------                                        --------------------
--------------------                                                            --------------------                                                            --------------------                    --------------------                    --------------------                                                            --------------------                                                            --------------------                    --------------------
|     HASH_JOIN    |                                                            |     HASH_JOIN    |                                                            |   CROSS_PRODUCT  |                    |     SEQ_SCAN     |                    |     HASH_JOIN    |                                                            |     HASH_JOIN    |                                                            |   CROSS_PRODUCT  |                    |     SEQ_SCAN     |
|       LEFT       |                                                            |       LEFT       |                                                            |                  |                    |     date_dim     |                    |       LEFT       |                                                            |       LEFT       |                                                            |                  |                    |     date_dim     |
|    cs_item_sk    |                                                            |    ss_item_sk    |                                                            |                  |                    |                  |                    |    cs_item_sk    |                                                            |    ss_item_sk    |                                                            |                  |                    |                  |
|    =cr_item_sk   |                                                            |    =sr_item_sk   |                                                            |                  |                    |                  |                    |    =cr_item_sk   |                                                            |    =sr_item_sk   |                                                            |                  |                    |                  |
|  cs_order_number |                                                            | ss_ticket_number |                                                            |                  |                    |                  |                    |  cs_order_number |                                                            | ss_ticket_number |                                                            |                  |                    |                  |
| =cr_order_number |                                                            | =sr_ticket_numbe |                                                            |                  |                    |                  |                    | =cr_order_number |                                                            | =sr_ticket_numbe |                                                            |                  |                    |                  |
|                  |                                                            |         r        |                                                            |                  |                    |                  |                    |                  |                                                            |         r        |                                                            |                  |                    |                  |
|      (0.00s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |                    |      (0.00s)     |                    |     (16.29s)     |                                                            |      (0.00s)     |                                                            |      (0.00s)     |                    |      (0.00s)     |
|         0        |                                                            |         0        |                                                            |         0        |                    |         0        |                    |     766926848    |                                                            |         0        |                                                            |         0        |                    |         0        |
--------------------                                                            --------------------                                                            --------------------                    --------------------                    --------------------                                                            --------------------                                                            --------------------                    --------------------
--------------------                                        ----------------------------------------                                        ------------------------------------------------------------                                        --------------------                                        ----------------------------------------                                        ------------------------------------------------------------
|   CROSS_PRODUCT  |                                        |     SEQ_SCAN     ||   CROSS_PRODUCT  |                                        |     SEQ_SCAN     ||     SEQ_SCAN     ||     SEQ_SCAN     |                                        |   CROSS_PRODUCT  |                                        |     SEQ_SCAN     ||   CROSS_PRODUCT  |                                        |     SEQ_SCAN     ||     SEQ_SCAN     ||     SEQ_SCAN     |
|                  |                                        |  catalog_returns ||                  |                                        |   store_returns  ||     web_sales    ||       item       |                                        |                  |                                        |  catalog_returns ||                  |                                        |   store_returns  ||     web_sales    ||       item       |
|      (0.00s)     |                                        |      (0.00s)     ||      (0.00s)     |                                        |      (0.00s)     ||      (0.00s)     ||      (0.00s)     |                                        |      (1.83s)     |                                        |      (0.00s)     ||      (0.00s)     |                                        |      (0.00s)     ||      (0.00s)     ||      (0.00s)     |
|         0        |                                        |         0        ||         0        |                                        |         0        ||         0        ||         0        |                                        |     766926848    |                                        |      144067      ||         0        |                                        |         0        ||         0        ||         0        |
--------------------                                        ----------------------------------------                                        ------------------------------------------------------------                                        --------------------                                        ----------------------------------------                                        ------------------------------------------------------------
--------------------                    --------------------                    --------------------                    --------------------                                                                                                    --------------------                    --------------------                    --------------------                    --------------------
|   CROSS_PRODUCT  |                    |     SEQ_SCAN     |                    |   CROSS_PRODUCT  |                    |     SEQ_SCAN     |                                                                                                    |   CROSS_PRODUCT  |                    |     SEQ_SCAN     |                    |   CROSS_PRODUCT  |                    |     SEQ_SCAN     |
|                  |                    |     date_dim     |                    |                  |                    |     date_dim     |                                                                                                    |                  |                    |     date_dim     |                    |                  |                    |     date_dim     |
|      (0.00s)     |                    |      (0.00s)     |                    |      (0.00s)     |                    |      (0.00s)     |                                                                                                    |      (0.00s)     |                    |      (0.00s)     |                    |      (0.00s)     |                    |      (0.00s)     |
|         0        |                    |         0        |                    |         0        |                    |         0        |                                                                                                    |       11264      |                    |       73049      |                    |         0        |                    |         0        |
--------------------                    --------------------                    --------------------                    --------------------                                                                                                    --------------------                    --------------------                    --------------------                    --------------------
----------------------------------------                                        ----------------------------------------                                                                                                                        ----------------------------------------                                        ----------------------------------------
|     SEQ_SCAN     ||     SEQ_SCAN     |                                        |     SEQ_SCAN     ||     SEQ_SCAN     |                                                                                                                        |     SEQ_SCAN     ||     SEQ_SCAN     |                                        |     SEQ_SCAN     ||     SEQ_SCAN     |
|   catalog_sales  ||       item       |                                        |    store_sales   ||       item       |                                                                                                                        |   catalog_sales  ||       item       |                                        |    store_sales   ||       item       |
|      (0.00s)     ||      (0.00s)     |                                        |      (0.00s)     ||      (0.00s)     |                                                                                                                        |      (0.00s)     ||      (0.00s)     |                                        |      (0.00s)     ||      (0.00s)     |
|         0        ||         0        |                                        |         0        ||         0        |                                                                                                                        |       1024       ||       18000      |                                        |         0        ||         0        |
----------------------------------------                                        ----------------------------------------                                                                                                                        ----------------------------------------                                        ----------------------------------------

